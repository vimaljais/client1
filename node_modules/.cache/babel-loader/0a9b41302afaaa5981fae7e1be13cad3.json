{"ast":null,"code":"import { createContext as e, useState as t, createElement as n, useContext as r, useMemo as o } from \"react\";\n\nvar a = new (function () {\n  function e(e) {\n    void 0 === e && (e = \"__LSM__\"), this.name = e, this.state = {}, this.middleWares = [];\n\n    try {\n      this.storageType = \"undefined\" != typeof sessionStorage ? window.sessionStorage : {};\n    } catch (e) {\n      this.storageType = {};\n    }\n  }\n\n  var t = e.prototype;\n  return t.updateStore = function (e) {\n    this.state = function (e, t) {\n      try {\n        return JSON.parse(e.getItem(t));\n      } catch (e) {\n        return null;\n      }\n    }(this.storageType, this.name) || e;\n  }, t.updateMiddleWares = function (e) {\n    return this.middleWares = e;\n  }, e;\n}())(),\n    i = e(void 0),\n    s = function (e) {\n  var r = e.children,\n      o = t(a.state);\n  return n(i.Provider, {\n    value: {\n      state: o[0],\n      setState: o[1]\n    }\n  }, r);\n};\n\nfunction _(e, t) {\n  var n, r, o;\n  void 0 === t && (t = {\n    name: \"__LSM__\",\n    middleWares: []\n  }), t.name && (a.name = t.name), t.storageType && (a.storageType = t.storageType), t.middleWares && a.updateMiddleWares(t.middleWares), \"production\" !== process.env.NODE_ENV && (n = a.storageType, r = a.name, o = a.state, \"undefined\" != typeof window && (window.__LSM__ = r, window.__LSM_NAME__ = r, window.__LSM_DEBUG__ = function (e) {\n    return n.setItem(\"___LSM_DEBUG__\", e);\n  }, window.__LSM_RESET__ = function () {\n    return n.removeItem(r);\n  }, window.__LSM_GET_STORE__ = function () {\n    return n.getItem(r);\n  }, window.__LSM_SAVE_TO__ = function (e) {\n    return window.localStorage.setItem(e, JSON.stringify(o));\n  }, window.__LSM_LOAD__ = function (e) {\n    return n.setItem(r || \"___LSM_DEBUG__\", e.data || window.localStorage.getItem(e.storeName) || \"\");\n  })), a.updateStore(e);\n}\n\nfunction d(e) {\n  var t,\n      n = (t = r(i), \"production\" !== process.env.NODE_ENV && (t || console.error(\"StateMachine context is undefined, please verify you are calling useStateMachine() as child of a <StateMachineProvider> component.\")), t),\n      s = n.state,\n      _ = n.setState;\n  return o(function () {\n    return {\n      actions: e ? Object.entries(e).reduce(function (e, t) {\n        var n;\n        return Object.assign({}, e, ((n = {})[t[0]] = function (e, t) {\n          return function (n) {\n            \"production\" !== process.env.NODE_ENV && (window.__LSM_NAME__ = t ? t.name : \"\"), a.state = t(a.state, n), a.storageType.setItem(a.name, JSON.stringify(a.state)), a.middleWares.length && (a.state = a.middleWares.reduce(function (e, r) {\n              return r(e, t.name, n) || e;\n            }, a.state)), e(a.state);\n          };\n        }(_, t[1]), n));\n      }, {}) : {},\n      state: s\n    };\n  }, [s, _, e]);\n}\n\nexport { s as StateMachineProvider, _ as createStore, d as useStateMachine };","map":{"version":3,"sources":["../src/logic/storeFactory.ts","../src/constants.ts","../src/logic/getBrowserStoreData.ts","../src/StateMachineContext.tsx","../src/stateMachine.tsx","../src/logic/devTool.ts"],"names":["this","name","storageType","sessionStorage","window","updateStore","defaultValues","state","getStoreData","updateMiddleWares","middleWares","storeName","JSON","parse","getItem","StateMachineContext","React","undefined","StateMachineProvider","children","storeFactory","Provider","value","setState","process","env","NODE_ENV","console","error","createStore","defaultState","options","callback","payload","setItem","stringify","length","reduce","currentValue","currentFunction","useStateMachine","actions","Object","entries","previous","assign","actionTemplate","__LSM__","__LSM_NAME__","__LSM_DEBUG__","__LSM_RESET__","removeItem","__LSM_GET_STORE__","__LSM_SAVE_TO__","localStorage","__LSM_LOAD__","data"],"mappings":"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","sourcesContent":["import { STORE_DEFAULT_NAME } from '../constants';\nimport getStoreData from './getBrowserStoreData';\nimport { MiddleWare, GlobalState } from '../types';\n\nclass StoreFactory {\n  public storageType: Storage;\n  public state: GlobalState = {};\n  public middleWares: MiddleWare[] = [];\n\n  constructor(public name = STORE_DEFAULT_NAME) {\n    try {\n      this.storageType =\n        typeof sessionStorage !== 'undefined'\n          ? window.sessionStorage\n          : ({} as Storage);\n    } catch {\n      this.storageType = {} as Storage;\n    }\n  }\n\n  updateStore(defaultValues: GlobalState) {\n    this.state = getStoreData(this.storageType, this.name) || defaultValues;\n  }\n\n  updateMiddleWares(middleWares: MiddleWare[]) {\n    return (this.middleWares = middleWares);\n  }\n}\n\nexport default new StoreFactory();\n","export const STORE_DEFAULT_NAME = '__LSM__';\nexport const STORE_ACTION_NAME = '__LSM_NAME__';\n","export default (storageType: Storage, storeName: string) => {\n  try {\n    return JSON.parse(storageType.getItem(storeName) as string);\n  } catch {\n    return null;\n  }\n};\n","import * as React from 'react';\nimport storeFactory from './logic/storeFactory';\nimport { StateMachineContextValue } from './types';\n\nconst StateMachineContext = React.createContext<StateMachineContextValue>(undefined as any);\n\nexport const StateMachineProvider: React.FC = ({ children }) => {\n  const [state, setState] = React.useState(storeFactory.state);\n\n  return (\n    <StateMachineContext.Provider\n      value={{ state, setState }}\n    >\n      { children }\n    </StateMachineContext.Provider>\n  );\n}\n\nexport function useStateMachineContext() {\n  const value = React.useContext<StateMachineContextValue>(StateMachineContext);\n\n  if (process.env.NODE_ENV !== 'production') {\n    if (!value) {\n      console.error(`StateMachine context is undefined, please verify you are calling useStateMachine() as child of a <StateMachineProvider> component.`)\n    }\n  }\n\n  return value;\n}","import * as React from 'react';\nimport { useStateMachineContext } from './StateMachineContext';\nimport storeFactory from './logic/storeFactory';\nimport { setUpDevTools } from './logic/devTool';\nimport {\n  StateMachineOptions,\n  GlobalState,\n  AnyCallback,\n  AnyActions,\n  ActionsOutput,\n} from './types';\nimport { STORE_ACTION_NAME, STORE_DEFAULT_NAME } from './constants';\n\nexport function createStore(\n  defaultState: GlobalState,\n  options: StateMachineOptions = {\n    name: STORE_DEFAULT_NAME,\n    middleWares: [],\n  },\n) {\n  options.name && (storeFactory.name = options.name);\n  options.storageType && (storeFactory.storageType = options.storageType);\n  options.middleWares && storeFactory.updateMiddleWares(options.middleWares);\n\n  if (process.env.NODE_ENV !== 'production') {\n    setUpDevTools(\n      storeFactory.storageType,\n      storeFactory.name,\n      storeFactory.state,\n    );\n  }\n\n  storeFactory.updateStore(defaultState);\n}\n\nfunction actionTemplate<TCallback extends AnyCallback>(\n  setState: React.Dispatch<React.SetStateAction<GlobalState>>,\n  callback: TCallback,\n) {\n  return (payload: Parameters<TCallback>[1]) => {\n    if (process.env.NODE_ENV !== 'production') {\n      window[STORE_ACTION_NAME] = callback ? callback.name : '';\n    }\n\n    storeFactory.state = callback(storeFactory.state, payload);\n\n    storeFactory.storageType.setItem(\n      storeFactory.name,\n      JSON.stringify(storeFactory.state),\n    );\n\n    if (storeFactory.middleWares.length) {\n      storeFactory.state = storeFactory.middleWares.reduce(\n        (currentValue, currentFunction) =>\n          currentFunction(currentValue, callback.name, payload) || currentValue,\n        storeFactory.state,\n      );\n    }\n\n    setState(storeFactory.state);\n  };\n}\n\nexport function useStateMachine<\n  TCallback extends AnyCallback,\n  TActions extends AnyActions<TCallback>\n>(\n  actions?: TActions,\n): {\n  actions: ActionsOutput<TCallback, TActions>;\n  state: GlobalState;\n} {\n  const { state, setState } = useStateMachineContext();\n\n  return React.useMemo(\n    () => ({\n      actions: actions\n        ? Object.entries(actions).reduce(\n            (previous, [key, callback]) =>\n              Object.assign({}, previous, {\n                [key]: actionTemplate(setState, callback),\n              }),\n            {},\n          )\n        : ({} as any),\n      state,\n    }),\n    [state, setState, actions],\n  );\n}\n","import { GlobalState } from \"../types\";\n\nexport function setUpDevTools(\n  storageType: Storage,\n  name: string,\n  state: GlobalState,\n) {\n  if (typeof window === 'undefined') return;\n\n  window.__LSM__ = name;\n\n  window.__LSM_NAME__ = name;\n\n  window.__LSM_DEBUG__ = (value: string) =>\n    storageType.setItem('___LSM_DEBUG__', value);\n\n  window.__LSM_RESET__ = () => storageType.removeItem(name);\n\n  window.__LSM_GET_STORE__ = () => storageType.getItem(name);\n\n  window.__LSM_SAVE_TO__ = (name: any) =>\n    window.localStorage.setItem(name, JSON.stringify(state));\n\n  window.__LSM_LOAD__ = ({\n    storeName,\n    data,\n  }: {\n    storeName: string;\n    data?: string;\n  }) =>\n    storageType.setItem(\n      name || '___LSM_DEBUG__',\n      data || window.localStorage.getItem(storeName) || '',\n    );\n}\n"]},"metadata":{},"sourceType":"module"}